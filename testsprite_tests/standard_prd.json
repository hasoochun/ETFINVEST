{
  "meta": {
    "project": "Infinite Buying Bot",
    "date": "2025-12-05",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "Infinite Buying Bot is an automated trading backend that interacts with the KIS API to manage a portfolio of assets (TQQQ, SHV, SCHD) by monitoring market status, executing trades, and sending real-time notifications via Telegram.",
  "core_goals": [
    "Enable automated trading through integration with KIS API for accurate price and balance retrieval and order execution.",
    "Maintain a balanced portfolio allocation with TQQQ 30%, SHV 50%, and SCHD 20%, including rebalancing triggers based on deviation thresholds.",
    "Accurately detect US market open/close times based on timezone logic to control trading activity.",
    "Provide real-time updates and command handling through Telegram Bot integration for monitoring and controlling the trading bot.",
    "Ensure robust data persistence with logging of trades and portfolio snapshots to an SQLite database for audit and analysis."
  ],
  "key_features": [
    "Trader Core module to handle API communication for prices, balances, and order transactions including fallback to Yahoo Finance for price retrieval failure.",
    "Portfolio Manager to calculate asset allocation percentages and trigger rebalancing within configured error margins.",
    "Scheduler utility for time-based market open detection aligned to US/Eastern timezone and calculate time until market open.",
    "Bot Controller to maintain bot state, respond to Telegram commands like /status and /balance, and send notifications on trade events.",
    "Database integration storing trades and portfolio snapshots in dashboard/trading.db with automatic creation and connection.",
    "Support for simulation and accelerated run modes to facilitate testing regardless of actual market hours.",
    "Environment configuration management and secure token handling for KIS API and Telegram integration."
  ],
  "user_flow_summary": [
    "User starts the bot which initializes environment variables and validates API tokens for KIS and Telegram.",
    "Bot controller verifies market status via Scheduler to assess if trading is permitted based on US market hours.",
    "Trader Core retrieves current prices and balances from KIS API; if price retrieval fails, falls back to Yahoo Finance data.",
    "Portfolio Manager calculates current portfolio allocations and determines if rebalancing is required based on deviation thresholds.",
    "If rebalancing or trading action is needed, Trader Core executes buy/sell orders accordingly.",
    "All trade activities and periodic portfolio snapshots are logged into the SQLite database for audit trail.",
    "Telegram bot listens for user commands such as /status and /balance and sends back realtime status updates.",
    "User receives Telegram notifications about bot start, trade executions, and errors for timely awareness.",
    "Users can run the bot in simulation or accelerated modes for testing without dependence on actual market open times."
  ],
  "validation_criteria": [
    "Environment variables including TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, and KIS keys are correctly set and validated by the bot before trading.",
    "KIS API authentication tokens are successfully generated and used for all API calls.",
    "Trader Core correctly fetches balances and prices for TQQQ, SHV, SCHD with no occurrence of zero buying power errors.",
    "Fallback to Yahoo Finance for price data works seamlessly when KIS API price retrieval fails.",
    "Buy and sell orders are executed successfully during market hours and simulated trading works as expected in simulation mode.",
    "Scheduler accurately reports market open status and time until next open based on US/Eastern timezone.",
    "Portfolio allocations are computed correctly to the configured percentages and rebalancing triggers correctly activate trades when deviation exceeds threshold.",
    "Telegram commands such as /status and /balance return accurate and timely responses to users.",
    "Database files (dashboard/trading.db) are created or connected at bot start, and trade plus portfolio snapshot data are persistently recorded.",
    "End-to-end testing with main_portfolio.py shows correct bot behavior in normal, simulation, and accelerated modes with proper notification delivery via Telegram."
  ],
  "code_summary": {
    "tech_stack": [
      "python",
      "pandas",
      "requests",
      "sqlite3",
      "telegram-bot-api"
    ],
    "features": [
      {
        "name": "Trader Core",
        "description": "Handles interaction with KIS API for getting prices, balances, and executing buy/sell orders.",
        "files": [
          "infinite_buying_bot/core/trader.py",
          "infinite_buying_bot/api/kis_api.py"
        ]
      },
      {
        "name": "Portfolio Manager",
        "description": "Manages asset allocation (TQQQ, SHV, SCHD) and calculates portfolio statistics.",
        "files": [
          "infinite_buying_bot/core/portfolio_manager.py",
          "infinite_buying_bot/core/rebalancing_engine.py"
        ]
      },
      {
        "name": "Market Scheduler",
        "description": "Determines if the US market is open using US/Eastern timezone logic.",
        "files": [
          "infinite_buying_bot/utils/scheduler.py"
        ]
      },
      {
        "name": "Bot Controller",
        "description": "Controls the bot state and interfaces with Telegram.",
        "files": [
          "infinite_buying_bot/api/bot_controller.py"
        ]
      }
    ]
  }
}
